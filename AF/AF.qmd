---
title: "An√°lise Fatorial de Indicadores Municipais"
subtitle: "Padr√µes Socioecon√¥micos em Cidades Brasileiras"
author: "Gabriel Cardoso"
lang: pt
format:
  html:
    theme: cosmo
    toc: true
    toc-location: left
    code-fold: true
    code-summary: "Exibir c√≥digo"
    number-sections: true
    self-contained: true
editor: visual
bibliography: references.bib
nocite: |
  @*
---

# **An√°lise Fatorial de Indicadores Municipais ‚Äì Cidades Brasileiras**

## üìä Resumo do Projeto

Este projeto utiliza dados agregados de cidades brasileiras, contendo indicadores demogr√°ficos, econ√¥micos e sociais, coletados de fontes p√∫blicas e compilados para fins de an√°lise comparativa. O conjunto de dados inclui informa√ß√µes como popula√ß√£o, PIB, densidade populacional, educa√ß√£o, sa√∫de e infraestrutura urbana, permitindo explorar padr√µes de desenvolvimento entre os munic√≠pios.

O objetivo da an√°lise √© identificar fatores latentes que sintetizem padr√µes subjacentes nos indicadores municipais, por meio da **An√°lise Fatorial Explorat√≥ria (AFE)**. Para isso, s√£o aplicados testes de adequa√ß√£o dos dados, como KMO e teste de esfericidade de Bartlett, m√©todos de extra√ß√£o de fatores e t√©cnicas de rota√ß√£o, garantindo uma interpreta√ß√£o consistente dos fatores identificados.

Os resultados fornecem uma representa√ß√£o reduzida e interpret√°vel da estrutura dos dados, evidenciando dimens√µes latentes de desenvolvimento socioecon√¥mico municipal, que podem ser utilizadas em an√°lises complementares, como agrupamento de cidades por perfil, constru√ß√£o de √≠ndices de desenvolvimento ou an√°lises comparativas regionais.

# An√°lise Fatorial

A **An√°lise Fatorial (AF)** √© uma t√©cnica estat√≠stica utilizada para **identificar estruturas latentes** que explicam as correla√ß√µes entre um conjunto de vari√°veis observadas $(X_1, X_2, X_3)$. O objetivo principal √© reduzir a dimensionalidade dos dados, representando $p$ vari√°veis originais por um n√∫mero menor $m$ de fatores n√£o observ√°veis $(F_1, F_2,...,F_m)$, capazes de capturar a varia√ß√£o comum entre as vari√°veis.

O modelo fatorial pode ser expresso como:

$$
X_j = \lambda_{j1}F_1 + \lambda_{j2}F_2 + \dots + \lambda_{jm}F_m + \varepsilon_j, \quad j=1, 2, \dots, p$$

onde:

-   $X_j$: √© a vari√°vel observada $j$

-   $\lambda_{j1}$: a carga fatorial da vari√°vel $j$ no fator $k$, indicando intensidade da rela√ß√£o.

-   $F_k$: √© o fator latente $k$.

-   $\varepsilon_j$: √© o termo de erro espec√≠fico da vari√°vel $j$, n√£o explicado pelos fatores comuns.

    ![](esquema.png)

A interpreta√ß√£o dos fatores √© facilitada por **t√©cnicas de rota√ß√£o**, como **Varimax** (ortogonal) ou **Oblimin** (obl√≠qua), que buscam simplificar a estrutura das cargas fatoriais, tornando cada fator mais representativo de um conjunto reduzido de vari√°veis.

A an√°lise fatorial √© amplamente utilizada em disciplinas como **psicologia, educa√ß√£o, marketing e ci√™ncias sociais** para:

1.  Identificar padr√µes subjacentes em dados complexos;

2.  Reduzir a dimensionalidade dos dados;

3.  Criar √≠ndices ou scores representativos de fatores latentes;

4.  Interpretar vari√°veis altamente correlacionadas de forma mais clara.

# Carregando e Tratando os Dados

```{r,warning=FALSE,message=FALSE,echo=FALSE}
setwd("C:/Users/gabriel.cardoso/Desktop/projetos github/PROJETOS COM R/AF")
```

```{r,warning=FALSE,message=FALSE}
library(tidyverse)
library(psych)       # Para KMO, Bartlett e AFE
library(GPArotation) # Para rota√ß√£o varimax
library(factoextra)  # Para gr√°ficos de PCA
library(corrplot)    # Para visualizar correla√ß√µes
library(rio)

df <- import("BRAZIL_CITIES.csv")

# Inspecionar o dataset
str(df)
```

Selecionar vari√°veis de interesse para ser mais din√¢mico

```{r}

# 1Ô∏è‚É£ Sele√ß√£o de vari√°veis num√©ricas existentes
variaveis_afe <- c(
  "IBGE_RES_POP_BRAS",   # popula√ß√£o
  "AREA",                # √°rea do munic√≠pio
  "GDP",                 # PIB
  "GDP_CAPITA",          # PIB per capita
  "IDHM_Renda",          # renda
  "IDHM_Educacao",       # educa√ß√£o
  "IDHM_Longevidade",    # longevidade
  "Cars",                # carros
  "Motorcycles",         # motos
  "FIXED_PHONES",        # telefones fixos
  "PAY_TV"               # TVs
)

dados_afe <- df %>% select(all_of(variaveis_afe))
```

```{r}
# 2Ô∏è‚É£ Converter AREA para num√©rico (tem v√≠rgula no CSV)
dados_afe$AREA <- as.numeric(gsub(",", "", dados_afe$AREA))

# 3Ô∏è‚É£ Tratar missing
dados_afe <- dados_afe %>% mutate(across(everything(), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))
```

# Visualizar correla√ß√µes

```{r}
corrplot(cor(dados_afe), 
         method = "color", 
         tl.col = "black", 
         tl.cex = 0.8, 
         tl.srt = 45,      # Inclina os nomes do topo
         addCoef.col = "white", # Opcional: mostra os n√∫meros da correla√ß√£o em branco
         number.cex = 0.7)
```

Observe o bloco azul escuro no canto inferior direito e no canto superior esquerdo. Vari√°veis como **IBGE_RES_POP**, **GDP (PIB)**, **Cars**, **Fixed_Phones** e **Pay_TV** est√£o quase que perfeitamente correlacionadas ($r \approx 1$).

-   **O que isso significa:** Elas est√£o medindo basicamente a mesma coisa: "tamanho da cidade" ou "riqueza total".

# An√°lise Fatorial

## Testes de adequa√ß√£o

```{r}
kmo_result <- KMO(cor(dados_afe))
kmo_result$MSA
```

O KMO alto confirma : as vari√°veis est√£o t√£o correlacionadas entre si que faz muito sentido "compact√°-las" em um √∫nico fator (por exemplo, um √≠ndice de "Riqueza/Infraestrutura"). Se as correla√ß√µes fossem baixas, o KMO seria baixo, indicando que cada vari√°vel est√° indo para um lado e n√£o podem ser resumidas.

```{r}
bartlett_test <- cortest.bartlett(cor(dados_afe), n = nrow(dados_afe))
bartlett_test
```

Os testes **KMO (0,84)** e de **Bartlett (p \< 0,001)** confirmam a alta adequabilidade dos dados para an√°lise fatorial. O valor de KMO indica que as vari√°veis s√£o consistentes entre si, enquanto o teste de Bartlett rejeita a independ√™ncia das vari√°veis, autorizando a redu√ß√£o dos dados em componentes principais.

## C√°lculo e Visualiza√ß√£o dos Autovalores

```{r}
# Calculando a matriz de correla√ß√£o e os autovalores
matriz_cor <- cor(dados_afe)
autovalores <- eigen(matriz_cor)$values

# Criando o Scree Plot (Gr√°fico de Cotovelo)
plot(autovalores, type = "b", pch = 19, col = "blue",
     main = "Scree Plot (Gr√°fico de Cotovelo)",
     xlab = "N√∫mero do Componente",
     ylab = "Autovalor (Vari√¢ncia Explicada)")
abline(h = 1, col = "red", lty = 2) # Linha de corte do Crit√©rio de Kaiser
```

An√°lise do Gr√°fico:

-   **Crit√©rio de Kaiser:** Temos exatamente **2 componentes** com autovalores (eigenvalues) nitidamente acima de 1.

-   **O Terceiro Ponto:** Note que o componente 3 est√° exatamente em cima da linha (ou ligeiramente abaixo). Isso sugere que manter apenas **2 fatores** √© a decis√£o mais elegante e estatisticamente econ√¥mica.

-   **Vari√¢ncia:** O primeiro componente sozinho explica uma quantidade enorme da varia√ß√£o (quase 6 unidades), o que confirma aquela forte correla√ß√£o que vimos no in√≠cio

## Rodando a PCA

```{r}
library(factoextra)

# Executando a PCA (usando 2 componentes conforme o gr√°fico)
res.pca <- prcomp(dados_afe, scale = TRUE)
```

```{r}
fviz_pca_var(res.pca,
             col.var = "contrib", # Cor por contribui√ß√£o
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE,        # Evita sobreposi√ß√£o de nomes
             title = "Mapa de Vari√°veis - Contribui√ß√£o para o Modelo")
```

Este gr√°fico revela a estrutura oculta dos seus dados. Observe que as vari√°veis se agruparam em dois eixos principais:

-   **Dim1 (Eixo Horizontal - 53.1% da vari√¢ncia):** √â o eixo do **"Porte Econ√¥mico e Infraestrutura"**. Vari√°veis como *Cars, GDP, Fixed Phones* e *Population* est√£o coladas no eixo horizontal. Quanto mais para a direita uma cidade estiver, maior ela √© em termos de volume econ√¥mico.

-   **Dim2 (Eixo Vertical - 25.7% da vari√¢ncia):** √â o eixo do **"Desenvolvimento Humano"**. As vari√°veis de *IDHM (Renda, Longevidade, Educa√ß√£o)* e *GDP per capita* apontam para cima.

-   **Interpreta√ß√£o:** Note que os dois grupos formam um √¢ngulo de quase **90 graus**. Isso significa que, no seu banco de dados, ser uma cidade "grande/rica em volume" (Dim1) n√£o garante automaticamente um "IDHM alto" (Dim2). S√£o dimens√µes independentes.

-   **A vari√°vel AREA:** Ela aponta para baixo e √© curta (cor azul), indicando que tem **baixa contribui√ß√£o** para explicar esses dois fatores principais.

```{r}
fviz_contrib(res.pca, choice = "var", axes = 1, fill = "skyblue", color = "black")
```

Contribui√ß√£o para a Dim-1 (Gr√°fico de Barras)

Este gr√°fico confirma quem manda no primeiro componente.

-   As vari√°veis que ultrapassam a **linha tracejada vermelha** s√£o as que realmente definem esse fator.

-   *Cars, Fixed Phones, Popula√ß√£o, Pay TV* e *GDP* s√£o praticamente id√™nticas em peso. Voc√™ poderia criar um "√çndice de Urbaniza√ß√£o/Riqueza" usando apenas elas.

## Como saber se o modelo √© realmente bom?

```{r}
# Ver as cargas fatoriais
res.pca$rotation[, 1:2]
```

**Interpreta√ß√£o das Cargas Fatoriais (`rotation`)**

As cargas mostram a correla√ß√£o de cada vari√°vel com os componentes.

-   **PC1 (Eixo de Estrutura/Porte):** √â dominado por vari√°veis com cargas em torno de **0.40** (Popula√ß√£o, PIB, Carros, Telefones). Elas caminham juntas: cidades grandes t√™m muita infraestrutura bruta.

-   **PC2 (Eixo de Bem-Estar):** √â dominado por **IDHM_Renda (0.53)**, **IDHM_Educacao (0.50)** e **IDHM_Longevidade (0.51)**.

-   **Insight:** A vari√°vel **AREA** tem carga quase zero em ambos, confirmando que o tamanho geogr√°fico n√£o explica nem riqueza nem desenvolvimento.

```{r}
# Calcular comunalidades
var_coord <- res.pca$rotation^2
rowSums(var_coord[, 1:2]) # Soma dos quadrados das cargas nos 2 fatores
```

A comunalidade mostra o "aproveitamento" da vari√°vel pelo modelo.

-   Os valores de IDHM est√£o mais altos (\~0.30), enquanto os de porte f√≠sico est√£o em torno de 0.17.

-   **Aten√ß√£o:** Como esses valores s√£o os quadrados das cargas da matriz de rota√ß√£o (`res.pca$rotation^2`), eles representam a contribui√ß√£o individual de cada vari√°vel na constru√ß√£o do eixo. A soma total de todas as comunalidades ser√° sempre 1 por componente.

# Conclus√£o

A aplica√ß√£o da An√°lise Fatorial Explorat√≥ria (AFE) demonstrou ser altamente eficaz para a s√≠ntese dos indicadores municipais. Os testes de diagn√≥stico iniciais, **KMO (0,84)** e **Bartlett (p \< 0,001)**, ratificaram a robustez estat√≠stica do conjunto de dados, confirmando que as correla√ß√µes existentes n√£o eram aleat√≥rias e permitiam a redu√ß√£o dimensional.

A extra√ß√£o dos componentes, orientada pelo Crit√©rio de Kaiser e pelo Gr√°fico de Cotovelo, revelou que **78,8% da vari√¢ncia total** dos dados pode ser explicada por apenas dois fatores latentes principais:

1.  **Dimens√£o de Porte e Infraestrutura Econ√¥mica (PC1):** Este fator sintetiza o volume bruto das cidades, agrupando vari√°veis como Popula√ß√£o, PIB Total, frota de ve√≠culos e acesso a servi√ßos de telecomunica√ß√µes. √â o eixo que diferencia grandes centros urbanos de munic√≠pios menores.

2.  **Dimens√£o de Desenvolvimento Humano e Efici√™ncia (PC2):** Este eixo isolou os indicadores de IDHM (Educa√ß√£o, Longevidade e Renda) e o PIB per capita. A independ√™ncia estat√≠stica observada entre este fator e o primeiro sugere que o crescimento econ√¥mico quantitativo (PIB Total) n√£o se traduz automaticamente em qualidade de vida qualitativa (IDHM) na mesma propor√ß√£o.

A vari√°vel "√Årea Territorial" apresentou baixa comunalidade, indicando que a extens√£o geogr√°fica n√£o √© um determinante direto do desenvolvimento socioecon√¥mico neste modelo. Em suma, a an√°lise permitiu transformar 11 indicadores complexos em duas dimens√µes interpret√°veis, fornecendo uma base s√≥lida para a cria√ß√£o de rankings municipais ou futuras estrat√©gias de segmenta√ß√£o de pol√≠ticas p√∫blicas baseadas no perfil real de cada munic√≠pio.
